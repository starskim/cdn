(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{132:function(e,t,a){"use strict";function n(e){return t=>{if(!t)return e}}a.d(t,"a",(function(){return n}))},142:function(e,t,a){"use strict";var n=a(6),s=a.n(n),i=a(1),r={name:"Modal",props:{mode:{type:String,default:"confirm",validator:e=>["alert","confirm","prompt"].includes(e)},id:{type:String},title:{type:String,default:Object(i.b)("general.tip")},text:{type:String,default:""},dangerousHTML:{type:String},input:{type:String,default:""},placeholder:{type:String},inputType:{type:String,default:"text"},validator:{type:Function},type:{type:String,default:"default"},showHeader:{type:Boolean,default:!0},center:{type:Boolean,default:!1},okButtonText:{type:String,default:Object(i.b)("general.confirm")},okButtonType:{type:String,default:"primary"},cancelButtonText:{type:String,default:Object(i.b)("general.cancel")},cancelButtonType:{type:String,default:"secondary"},flexFooter:{type:Boolean,default:!1}},data(){return{hidden:!1,value:this.input,valid:!0,validatorMessage:""}},computed:{lines(){return this.text.split(/\r?\n/)},footerClasses(){return{"d-flex":this.flexFooter,"justify-content-between":this.flexFooter}}},mounted(){s()(this.$el).on("hide.bs.modal",()=>{this.hidden||this.dismiss()}).on("hidden.bs.modal",()=>{this.hidden=!1})},methods:{confirm(){if("function"==typeof this.validator){const e=this.validator(this.value);if("string"==typeof e)return this.validatorMessage=e,void(this.valid=!1)}this.hidden=!0,this.$emit("confirm",{value:this.value}),s()(this.$el).modal("hide")},dismiss(){this.hidden=!0,this.$emit("dismiss")}}},l=a(71),o=Object(l.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal fade",attrs:{id:e.id,tabindex:"-1",role:"dialog","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",class:{"modal-dialog-centered":e.center},attrs:{role:"document"}},[a("div",{staticClass:"modal-content",class:["bg-"+e.type]},[e.showHeader?a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title"},[e._v(e._s(e.title))]),e._v(" "),a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"},on:{click:e.dismiss}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("Ã—")])])]):e._e(),e._v(" "),a("div",{staticClass:"modal-body"},[e._t("default",[e.text?e._l(e.lines,(function(t,n){return a("p",{key:n},[e._v(e._s(t))])})):e.dangerousHTML?a("div",{domProps:{innerHTML:e._s(e.dangerousHTML)}}):e._e(),e._v(" "),"prompt"===e.mode?[a("div",{staticClass:"form-group"},["checkbox"===e.inputType?a("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],staticClass:"form-control",attrs:{placeholder:e.placeholder,type:"checkbox"},domProps:{checked:Array.isArray(e.value)?e._i(e.value,null)>-1:e.value},on:{input:function(t){e.valid=!0},change:function(t){var a=e.value,n=t.target,s=!!n.checked;if(Array.isArray(a)){var i=e._i(a,null);n.checked?i<0&&(e.value=a.concat([null])):i>-1&&(e.value=a.slice(0,i).concat(a.slice(i+1)))}else e.value=s}}}):"radio"===e.inputType?a("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],staticClass:"form-control",attrs:{placeholder:e.placeholder,type:"radio"},domProps:{checked:e._q(e.value,null)},on:{input:function(t){e.valid=!0},change:function(t){e.value=null}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],staticClass:"form-control",attrs:{placeholder:e.placeholder,type:e.inputType},domProps:{value:e.value},on:{input:[function(t){t.target.composing||(e.value=t.target.value)},function(t){e.valid=!0}]}})]),e._v(" "),e.valid?e._e():a("div",{staticClass:"alert alert-danger"},[a("i",{staticClass:"icon far fa-times-circle"}),e._v("\n              "+e._s(e.validatorMessage)+"\n            ")])]:e._e()])],2),e._v(" "),a("div",{staticClass:"modal-footer",class:e.footerClasses},[e._t("footer",["alert"!==e.mode?a("button",{staticClass:"btn",class:["btn-"+e.cancelButtonType],attrs:{type:"button","data-dismiss":"modal"},on:{click:e.dismiss}},[e._v("\n            "+e._s(e.cancelButtonText)+"\n          ")]):e._e(),e._v(" "),a("button",{staticClass:"btn",class:["btn-"+e.okButtonType],attrs:{type:"button"},on:{click:e.confirm}},[e._v("\n            "+e._s(e.okButtonText)+"\n          ")])])],2)])])])}),[],!1,null,null,null);t.a=o.exports},430:function(e,t,a){"use strict";a.r(t);var n=a(104),s=(a(103),a(142)),i=a(58),r=a(84),l=a(59),o=a(3),d=a(132),c={name:"PlayersManagement",components:{Modal:s.a,VueGoodTable:n.a},mixins:[l.a,i.a,r.a],props:{baseUrl:{type:String,default:blessing.base_url}},data(){return{players:[],columns:[{field:"pid",label:"PID",type:"number"},{field:"name",label:this.$t("general.player.player-name")},{field:"uid",label:this.$t("general.player.owner"),type:"number",sortable:!1},{field:"preview",label:this.$t("general.player.previews"),globalSearchDisabled:!0,sortable:!1},{field:"last_modified",label:this.$t("general.player.last-modified"),sortable:!1},{field:"operations",label:this.$t("admin.operationsTitle"),globalSearchDisabled:!0,sortable:!1}],textureChanges:{originalIndex:-1,type:"skin",tid:""}}},beforeMount(){this.fetchData()},methods:{async fetchData(){const{data:e,totalRecords:t}=await this.$http.get(`/admin/players/list${location.search}`,!location.search&&this.serverParams);this.totalRecords=t,this.players=e},async changeTexture(){const e=this.players[this.textureChanges.originalIndex],{type:t,tid:a}=this.textureChanges,{code:n,message:s}=await this.$http.post("/admin/players?action=texture",{pid:e.pid,type:t,tid:a});0===n?(e[`tid_${t}`]=a,o.b.success(s)):o.b.error(s)},async changeName(e){let t;try{({value:t}=await Object(o.a)({mode:"prompt",text:this.$t("admin.changePlayerNameNotice"),input:e.name,validator:Object(d.a)(this.$t("admin.emptyPlayerName"))}))}catch{return}const{code:a,message:n}=await this.$http.post("/admin/players?action=name",{pid:e.pid,name:t});0===a?(e.name=t,o.b.success(n)):o.b.error(n)},async changeOwner(e){let t;try{({value:t}=await Object(o.a)({mode:"prompt",text:this.$t("admin.changePlayerOwner"),input:e.uid}))}catch{return}t=Number.parseInt(t);const{code:a,message:n}=await this.$http.post("/admin/players?action=owner",{pid:e.pid,uid:t});0===a?(e.uid=t,o.b.success(n)):o.b.error(n)},async deletePlayer({pid:e,originalIndex:t}){try{await Object(o.a)({text:this.$t("admin.deletePlayerNotice"),okButtonType:"danger"})}catch{return}const{code:a,message:n}=await this.$http.post("/admin/players?action=delete",{pid:e});0===a?(this.$delete(this.players,t),o.b.success(n)):o.b.error(n)}}},u=a(71),p=Object(u.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container-fluid"},[a("vue-good-table",{attrs:{mode:"remote",rows:e.players,"total-rows":e.totalRecords||e.players.length,columns:e.columns,"search-options":e.tableOptions.search,"pagination-options":e.tableOptions.pagination,"style-class":"vgt-table striped"},on:{"on-page-change":e.onPageChange,"on-sort-change":e.onSortChange,"on-search":e.onSearch,"on-per-page-change":e.onPerPageChange},scopedSlots:e._u([{key:"table-row",fn:function(t){return["name"===t.column.field?a("span",[e._v("\n        "+e._s(t.formattedRow[t.column.field])+"\n        "),a("a",{attrs:{title:e.$t("admin.changePlayerName"),"data-test":"name"},on:{click:function(a){return e.changeName(t.row)}}},[a("i",{staticClass:"fas fa-edit btn-edit"})])]):"uid"===t.column.field?a("span",[a("a",{attrs:{href:e.baseUrl+"/admin/users?uid="+t.row.uid,title:e.$t("admin.inspectHisOwner"),"data-toggle":"tooltip","data-placement":"right"}},[e._v(e._s(t.formattedRow[t.column.field]))]),e._v(" "),a("a",{attrs:{title:e.$t("admin.changeOwner"),"data-test":"owner"},on:{click:function(a){return e.changeOwner(t.row)}}},[a("i",{staticClass:"fas fa-edit btn-edit"})])]):"preview"===t.column.field?a("span",[t.row.tid_skin?a("a",{attrs:{href:e.baseUrl+"/skinlib/show/"+t.row.tid_skin}},[a("img",{attrs:{src:e.baseUrl+"/preview/"+t.row.tid_skin+"?height=64",width:"64"}})]):e._e(),e._v(" "),t.row.tid_cape?a("a",{attrs:{href:e.baseUrl+"/skinlib/show/"+t.row.tid_cape}},[a("img",{attrs:{src:e.baseUrl+"/preview/"+t.row.tid_cape+"?height=64",width:"64"}})]):e._e()]):"operations"===t.column.field?a("span",[a("button",{staticClass:"btn btn-default",attrs:{"data-toggle":"modal","data-target":"#modal-change-texture"},on:{click:function(a){e.textureChanges.originalIndex=t.row.originalIndex}}},[e._v("\n          "+e._s(e.$t("admin.changeTexture"))+"\n        ")]),e._v(" "),a("button",{staticClass:"btn btn-danger",on:{click:function(a){return e.deletePlayer(t.row)}}},[e._v("\n          "+e._s(e.$t("admin.deletePlayer"))+"\n        ")])]):a("span",{domProps:{textContent:e._s(t.formattedRow[t.column.field])}})]}}])}),e._v(" "),a("modal",{attrs:{id:"modal-change-texture",title:e.$t("admin.changeTexture"),center:""},on:{confirm:e.changeTexture}},[a("div",{staticClass:"form-group"},[a("label",{directives:[{name:"t",rawName:"v-t",value:"admin.textureType",expression:"'admin.textureType'"}]}),e._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:e.textureChanges.type,expression:"textureChanges.type"}],staticClass:"form-control",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.textureChanges,"type",t.target.multiple?a:a[0])}}},[a("option",{directives:[{name:"t",rawName:"v-t",value:"general.skin",expression:"'general.skin'"}],attrs:{value:"skin"}}),e._v(" "),a("option",{directives:[{name:"t",rawName:"v-t",value:"general.cape",expression:"'general.cape'"}],attrs:{value:"cape"}})])]),e._v(" "),a("div",{staticClass:"form-group"},[a("label",[e._v("TID")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.textureChanges.tid,expression:"textureChanges.tid",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("admin.pidNotice")},domProps:{value:e.textureChanges.tid},on:{input:function(t){t.target.composing||e.$set(e.textureChanges,"tid",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])],1)}),[],!1,null,null,null);t.default=p.exports},58:function(e,t,a){"use strict";var n=a(44);t.a=n.default.extend({data(){return{tableOptions:{search:{enabled:!0,placeholder:this.$t("vendor.datatable.search")},pagination:{enabled:!0,nextLabel:this.$t("vendor.datatable.next"),prevLabel:this.$t("vendor.datatable.prev"),rowsPerPageLabel:this.$t("vendor.datatable.rowsPerPage"),allLabel:this.$t("vendor.datatable.all"),ofLabel:this.$t("vendor.datatable.of")}}}}})},59:function(e,t,a){"use strict";var n=a(44),s=a(2);t.a=n.default.extend({mounted(){s.a("mounted",{el:this.$root.$options.el})}})},84:function(e,t,a){"use strict";var n=a(44);t.a=n.default.extend({data:()=>({columns:[{field:"id"}],totalRecords:0,serverParams:{sortField:"id",sortType:"asc",page:1,perPage:10,search:""}}),created(){this.serverParams.sortField=this.columns[0].field},methods:{fetchData:()=>Promise.resolve(),onPageChange(e){this.serverParams.page=e.currentPage,this.fetchData()},onPerPageChange(e){this.serverParams.perPage=e.currentPerPage,this.fetchData()},onSortChange([e]){this.serverParams.sortType=e.type,this.serverParams.sortField=e.field,this.fetchData()},onSearch(e){this.serverParams.search=e.searchTerm,this.fetchData()}}})}}]);